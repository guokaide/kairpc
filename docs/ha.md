# HA

## 问题
1. 有节点宕机，通过多个 provider 集群 + 注册中心，可以运行期保障服务整体可用性；
2. 有节点偶尔异常，但是没有宕机，可以通过重试 + LoadBalance 重新选节点，实现此次调用的成功；
3. 有节点在一段时间内异常（比如说，这个实力上有很多服务，其中个别服务有问题）、没宕机，甚至其它服务一直是好的，通过故障隔离解决。
- 隔离：发现节点异常，隔离它
- 探活：每隔一段时间把隔离节点放出来，处理一部分流量，看服务是否正常，half open；探活好了，就可以故障恢复，full open

目前，我们实现的是单个服务的灰度，使用的方式是流量染色+调拨的方式。 
也可以是用户、单个调用的灰度，这个时候，染色就是调用的用户或者当前这次访问。
全链路的灰度：A -> B -> C -> DB, 路径上的所有组件都要染色，比如说，redis、mysql、mq 等中间件和数据库都要灰度。
可以通过 context 参数传递的方式实现，从 Consumer -> Provider。
全链路的压测：也是通过流量染色实现。